<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alternative Reality Classifier</title>
    <style>
        body {
            margin: 0;
            background: #0c0c0c;
            color: #f5f5f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            min-height: 100vh;
            overflow-x: hidden;
            text-align: center;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #f5f5f5;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'Courier New', Courier, monospace;
        }

        input[type="file"] {
            background: #1a1a1a;
            color: #aaa;
            border: 2px dashed #444;
            padding: 10px 15px;
            cursor: pointer;
            margin-bottom: 20px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

            input[type="file"]:hover {
                border-color: #D32F2F;
                color: #f5f5f5;
            }

        .card {
            background: #1a1a1a;
            border: 1px solid #2e2e2e;
            border-left: 5px solid #D32F2F;
            padding: 20px;
            width: 90vw;
            max-width: 380px;
            margin-top: 20px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.4);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hidden {
            display: none;
        }

        img {
            max-width: 100%;
            max-height: 250px;
            object-fit: contain;
            border-radius: 6px;
            margin-top: 10px;
        }

        button {
            background-color: #D32F2F;
            color: white;
            padding: 10px 20px;
            margin-top: 15px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s ease, box-shadow 0.3s ease;
        }

            button:hover {
                background-color: #b71c1c;
                box-shadow: 0 0 10px #D32F2F88;
            }

        #infoMessage {
            margin-top: 10px;
            color: #888;
            font-style: italic;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        form {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        input[type="text"], input[type="email"] {
            padding: 10px;
            border-radius: 6px;
            border: none;
            background: #2a2a2a;
            color: #fff;
        }

        p {
            margin: 8px 0;
        }

        #sendStatus {
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>THANK YOU FOR EXPLORING THE ALTERNATIVE REALITY</h1>

    <input type="file" accept="image/*" capture="environment" id="imageInput" />

    <button id="processButton" class="hidden">Process</button>

    <p id="infoMessage" class="hidden">Classifying material...</p>

    <div id="resultCard" class="card hidden">
        <h2>Material Identified</h2>
        <p><strong>Name of Material:</strong> <span id="materialName"></span></p>
        <p><strong>Confidence:</strong> <span id="confidence"></span></p>
        <button id="altRealityBtn">Show Alternative Reality Card</button>
    </div>

    <div id="altRealityCard" class="card hidden">
        <h2>Alternative Reality</h2>
        <img id="altImage" src="" alt="Alternative View" />
        <button onclick="printAltImage()">Print</button>
        <br>

        <!-- Feedback Form -->
        <form id="feedbackForm">
            <h3>Send the Alternative Reality Card</h3>
            <input type="text" id="userName" placeholder="Your Name" required />
            <input type="email" id="userEmail" placeholder="Your Email" required />
            <!--<input type="text" id="userOccupation" placeholder="Your Occupation" />-->
            <button type="submit">Send</button>
            <p id="sendStatus"></p>
        </form>
    </div>

    <button id="closeBtn" class="hidden">Close</button>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        emailjs.init("e25aZy85Okvh1kVnb");

    const imageInput = document.getElementById('imageInput');
    const processButton = document.getElementById('processButton');
    const infoMessage = document.getElementById('infoMessage');
    const resultCard = document.getElementById('resultCard');
    const materialName = document.getElementById('materialName');
    const confidence = document.getElementById('confidence');
    const altRealityBtn = document.getElementById('altRealityBtn');
    const altRealityCard = document.getElementById('altRealityCard');
    const altImage = document.getElementById('altImage');
    const closeBtn = document.getElementById('closeBtn');

    var dataURL;

    debugger;

    imageInput.addEventListener('change', () => {
        if (imageInput.files && imageInput.files.length > 0) {
            const file = imageInput.files[0];
            if (!file) return;

            const reader = new FileReader();

            reader.onload = function (e) {
                dataURL = e.target.result;
                console.log("Base64 Image URI:", dataURL);

                // You can now use dataURL to display, upload, or send via email
                // e.g. document.getElementById('preview').src = dataURL;
            };

            reader.readAsDataURL(file);
        processButton.classList.remove('hidden');
      }
    });

    processButton.addEventListener('click', () => {
        infoMessage.classList.remove('hidden');

        imageInput.addEventListener('change', function () {

        });
        var dataResult;
        fetch('https://www.nyckel.com/v1/functions/materials-identifier/invoke', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + 'eyJhbGciOiJSUzI1NiIsInR5cCI6ImF0K2p3dCJ9.eyJpc3MiOiJodHRwczovL3d3dy5ueWNrZWwuY29tIiwibmJmIjoxNzUzMDU0NjkzLCJpYXQiOjE3NTMwNTQ2OTMsImV4cCI6MTc1MzA1ODI5Mywic2NvcGUiOlsiYXBpIl0sImNsaWVudF9pZCI6InJhM2gxM2JnZjFod211Mm5wN21zajM0NTV0bDI4bXdlIiwianRpIjoiNkYzOUE0NDY5ODlGM0QyRkI1MUM4NTdDODI4REI0NjcifQ.hyFTN7ZMFRn45tsdCOP0Om_72-xjwcSkvPHYq_-vl6lugakkKLUERj6wQiOWnNXT2IpOpapu4fv7Di5f-vuSn_Oqim2S5D8_hfnfHoNHaL6v12Jj7tn48y0TCGipV6ty_EFdQEW4O8J_A4j5ReMiyNYCW9gVm7DFcLCmZRI2F-d9O-aea21csPYkm3UyKLFDsiPBBrffz50-Ljx-L3dQPoRFMgGd1hsummVYY6bT3x5RittYLhrEcQ8EJKAtQMRft0luxKHlxBg0OZGP9uoytjEyC4pn7CyGXC3764rK4lYbMLmzKXV4h-2q_C_XDatXmnDOfKe_4kAzAOXNHaypJg',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(
                { "data": dataURL }
            )
        })
        .then(response => response.json())
        .then(data => { dataResult = data; })
        .then(() => { materialName.textContent = dataResult.labelName; confidence.textContent = (dataResult.confidence.toFixed(2) * 100.00) + "%"; })

        setTimeout(() => {
            infoMessage.classList.add('hidden');
            resultCard.classList.remove('hidden');
        }, 1000);
    });

    altRealityBtn.addEventListener('click', () => {
      const material = materialName.textContent.toLowerCase();
      const imageMap = {
          glass: "./ImgVerre.jpg",
          paper: "./ImgPapier.jpg",
          metal: "./ImgFer.jpg",
          plastic: "./ImgPlastique.jpg",
          foliage: "./ImgFoliage.jpg",
          water: "./ImgEau.jpg",
          fabric: "./ImgCotton.jpg",
          leather: "./ImgCuir.jpg",
          wood: "./ImgBois.jpg",
          stone: "./ImgGranite.jpg"
      };
      const filename = imageMap[material] || "ImgVerre.jpg";
      altImage.src = filename;
      altRealityCard.classList.remove('hidden');
      closeBtn.classList.remove('hidden');
    });

    closeBtn.addEventListener('click', () => {
      imageInput.value = "";
      processButton.classList.add('hidden');
      infoMessage.classList.add('hidden');
      resultCard.classList.add('hidden');
      altRealityCard.classList.add('hidden');
      closeBtn.classList.add('hidden');
      altImage.src = "";
    });

    // Handle feedback form submission
    document.getElementById('feedbackForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const name = document.getElementById('userName').value;
        const email = document.getElementById('userEmail').value;
        //const occupation = document.getElementById('userOccupation').value;
        const material = materialName.textContent;
        const websiteLink = "https://saradaher.framer.website/contact";

        const altImageEl = document.getElementById('altImage');

        const params = {
            to_email: email,
            user_name: name,
            //user_occupation: occupation,
            material: material,
            website_link: websiteLink,
            card_image: altImageEl.src
        };

        emailjs.send("service_outlook_ma", "template_m1w2myv", params)
          .then(function (response) {
              document.getElementById('sendStatus').textContent = "Email sent successfully!";
          }, function (error) {
              document.getElementById('sendStatus').textContent = "Error sending email.";
              console.error("EmailJS Error:", error);
          });
    });

    function printAltImage() {
        const imgSrc = document.getElementById('altImage').src;

        const printWindow = window.open('', '_blank', 'width=800,height=600');
        printWindow.document.write(`
            <html>
              <head>
                <title>Print</title>
                <style>
                  body {
                    margin: 0;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    height: 100vh;
                    background: #000;
                  }
                  img {
                    max-width: 100%;
                    max-height: 100vh;
                    object-fit: contain;
                  }
                </style>
              </head>
              <body>
                <img src="${imgSrc}" />
                <script>
                  window.onload = function() {
                    setTimeout(() => {
                      window.print();
                      setTimeout(() => window.close(), 500); // Try to close after print
                    }, 500);
                  };
                <\/script>
              </body>
            </html>
          `);
        printWindow.document.close();
    }

    </script>
</body>
</html>
